/analytics/query/decision_outcomes_per_day:
  post:
    tags:
      - Analytics
    summary: Get decision outcomes per day
    operationId: getDecisionOutcomesPerDay
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AnalyticsQueryDto'
    responses:
      '400':
        $ref: 'components.yml#/responses/400'
      '200':
        description: The decision outcomes per day
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DecisionOutcomesPerDayResponseDto'
      '401':
        $ref: 'components.yml#/responses/401'
      '403':
        $ref: 'components.yml#/responses/403'
      '404':
        $ref: 'components.yml#/responses/404'
/analytics/query/rule_hit_table:
  post:
    tags:
      - Analytics
    summary: Get rule hit table
    operationId: getRuleHitTable
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AnalyticsQueryDto'
    responses:
      '400':
        $ref: 'components.yml#/responses/400'
      '200':
        description: The rule hit table
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/RuleHitTableResponseDto'
      '401':
        $ref: 'components.yml#/responses/401'
      '403':
        $ref: 'components.yml#/responses/403'
      '404':
        $ref: 'components.yml#/responses/404'
/analytics/query/screening_hits:
  post:
    tags:
      - Analytics
    summary: Get screening hits
    operationId: getScreeningHits
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AnalyticsQueryDto'
    responses:
      '200':
        description: The screening hits
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/ScreeningHitTableResponseDto'
/analytics/query/decisions_score_distribution:
  post:
    tags:
      - Analytics
    summary: Get decisions score distribution
    operationId: getDecisionsScoreDistribution
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AnalyticsQueryDto'
    responses:
      '200':
        description: The decisions score distribution
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DecisionsScoreDistributionResponseDto'
      '400':
        $ref: 'components.yml#/responses/400'
      '401':
        $ref: 'components.yml#/responses/401'
      '403':
        $ref: 'components.yml#/responses/403'
      '404':
        $ref: 'components.yml#/responses/404'
/analytics/query/rule_vs_decision_outcome:
  post:
    tags:
      - Analytics
    summary: Get rule vs decision outcome
    operationId: getRuleVsDecisionOutcome
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AnalyticsQueryDto'
    responses:
      '200':
        description: The rule vs decision outcome
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/RuleVsDecisionOutcomeResponseDto'
      '400':
        $ref: 'components.yml#/responses/400'
      '401':
        $ref: 'components.yml#/responses/401'
      '403':
        $ref: 'components.yml#/responses/403'
      '404':
        $ref: 'components.yml#/responses/404'
/analytics/available-filters:
  post:
    tags:
      - Analytics
    summary: Get available filters
    operationId: getAvailableFilters
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AvailableFiltersRequestDto'
    responses:
      '200':
        description: The available filters
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AvailableFiltersResponseDto'
components:
  schemas:
    ScenarioFilterDto:
      type: object
      required:
        - scenario_id
        - scenario_versions
      properties:
        scenario_id:
          type: string
          format: uuid
        scenario_versions:
          type: array
          items:
            type: integer
    DateRangeFilterDto:
      type: object
      required:
        - start
        - end
      properties:
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time
    FieldFilterDto:
      type: object
      required:
        - source
        - field
        - op
        - values
      properties:
        source:
          type: string
          enum: ['trigger_object']
        field:
          type: string
        op:
          type: string
          enum: ['=', '!=', '>', '>=', '<', '<=', 'in']
        values:
          type: array
          items:
            oneOf:
              - type: string
              - type: number
              - type: boolean
    AnalyticsQueryDto:
      allOf:
        - $ref: '#/components/schemas/ScenarioFilterDto'
        - $ref: '#/components/schemas/DateRangeFilterDto'
        - type: object
          required:
            - fields
          properties:
            fields:
              type: array
              items:
                $ref: '#/components/schemas/FieldFilterDto'
    DecisionOutcomesPerDayResponseDto:
      type: object
      required:
        - date
        - approve
        - block_and_review
        - decline
        - review
      properties:
        date:
          type: string
          format: date-time
        approve:
          type: integer
        block_and_review:
          type: integer
        decline:
          type: integer
        review:
          type: integer
    RuleHitTableResponseDto:
      type: object
      required:
        - rule_name
        - hit_count
        - hit_ratio
        - distinct_pivots
        - repeat_ratio
      properties:
        rule_name:
          type: string
        hit_count:
          type: integer
        hit_ratio:
          type: number
        distinct_pivots:
          type: integer
        repeat_ratio:
          type: number
    ScreeningHitTableResponseDto:
      type: object
      required:
        - config_id
        - name
        - execs
        - hits
        - hit_ratio
        - avg_hits_per_screening
      properties:
        config_id:
          type: string
          format: uuid
        name:
          type: string
        execs:
          type: integer
        hits:
          type: integer
        hit_ratio:
          type: number
        avg_hits_per_screening:
          type: number
    DecisionsScoreDistributionResponseDto:
      type: object
      required:
        - score
        - decisions
      properties:
        score:
          type: integer
        decisions:
          type: integer
    RuleVsDecisionOutcomeResponseDto:
      type: object
      required:
        - rule_name
        - outcome
        - decisions
      properties:
        rule_name:
          type: string
        outcome:
          $ref: 'decisions.yml#/components/schemas/OutcomeDto'
        decisions:
          type: integer
    AvailableFiltersRequestDto:
      type: object
      required:
        - scenario_id
        - start
        - end
      properties:
        scenario_id:
          type: string
          format: uuid
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time
    AvailableFiltersResponseDto:
      type: array
      items:
        type: object
        required:
          - name
          - type
          - source
        properties:
          name:
            type: string
          type:
            type: string
          source:
            type: string
            enum: ['trigger_object']

