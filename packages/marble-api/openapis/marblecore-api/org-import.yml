/org-export:
  get:
    tags:
      - Org import
    summary: Export an organization's data as JSON file
    operationId: exportOrganization
    security:
      - bearerAuth: []
    responses:
      "200":
        description: The exported organization data as a JSON file
        content:
          application/json:
            schema: {}
      "401":
        $ref: "components.yml#/responses/401"
      "403":
        $ref: "components.yml#/responses/403"
/org-import:
  post:
    tags:
      - Org import
    summary: Import an organization from a JSON file
    operationId: importOrganization
    security:
      - bearerAuth: []
    requestBody:
      description: The organization data to import as a JSON file
      content:
        application/json:
          schema: {}
      required: true
    responses:
      "200":
        description: The created organization ID
        content:
          application/json:
            schema:
              type: object
              required:
                - org_id
              properties:
                org_id:
                  type: string
                  format: uuid
      "400":
        $ref: "components.yml#/responses/400"
      "401":
        $ref: "components.yml#/responses/401"
      "403":
        $ref: "components.yml#/responses/403"
      "409":
        $ref: "components.yml#/responses/409"
        description: Conflict - the organization is not empty
/org-import/file:
  post:
    tags:
      - Org import
    summary: Import an organization from a JSON file upload
    operationId: importOrganizationFromFile
    security:
      - bearerAuth: []
    requestBody:
      description: The organization data to import as a JSON file upload
      content:
        multipart/form-data:
          schema:
            type: object
            required:
              - file
            properties:
              file:
                type: string
                format: binary
      required: true
    responses:
      "200":
        description: The created organization ID
        content:
          application/json:
            schema:
              type: object
              required:
                - org_id
              properties:
                org_id:
                  type: string
                  format: uuid
      "400":
        $ref: "components.yml#/responses/400"
      "401":
        $ref: "components.yml#/responses/401"
      "403":
        $ref: "components.yml#/responses/403"
      "409":
        $ref: "components.yml#/responses/409"
        description: Conflict - the organization is not empty
/org-import/archetypes:
  get:
    tags:
      - Org import
    summary: List available archetypes for org import
    operationId: listArchetypes
    security:
      - bearerAuth: []
    responses:
      "200":
        description: The list of available archetypes
        content:
          application/json:
            schema:
              type: object
              required:
                - archetypes
              properties:
                archetypes:
                  type: array
                  items:
                    $ref: "#/components/schemas/ArchetypeDto"
      "401":
        $ref: "components.yml#/responses/401"
      "403":
        $ref: "components.yml#/responses/403"

/org-import/archetypes/apply:
  post:
    tags:
      - Org import
    summary: Apply an archetype to create or seed an organization
    operationId: applyArchetype
    security:
      - bearerAuth: []
    parameters:
      - name: seed
        in: query
        description: If "true", seed the organization with archetype data
        required: false
        schema:
          type: string
          enum: ["true", "false"]
    requestBody:
      description: Describe the archetype to apply
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ArchetypeApplyDto"
      required: true
    responses:
      "200":
        description: The created organization ID
        content:
          application/json:
            schema:
              type: object
              required:
                - org_id
              properties:
                org_id:
                  type: string
                  format: uuid
      "400":
        $ref: "components.yml#/responses/400"
      "401":
        $ref: "components.yml#/responses/401"
      "403":
        $ref: "components.yml#/responses/403"
      "409":
        $ref: "components.yml#/responses/409"
        description: Conflict - the organization is not empty

components:
  schemas:
    ArchetypeDto:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        label:
          type: string
        description:
          type: string
    ArchetypeApplyDto:
      type: object
      required:
        - name
      properties:
        name:
          type: string
      oneOf:
        - description: Neither org_name nor admins provided
          not:
            required:
              - org_name
              - admins
        - description: Both org_name and admins provided
          required:
            - org_name
            - admins
          properties:
            org_name:
              type: string
            admins:
              type: array
              minItems: 1
              items:
                $ref: "admin.yml#/components/schemas/CreateUser"
